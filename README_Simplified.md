# 飞花令

> 春城无处不飞花。寒食东风御柳斜。日暮汉宫传蜡烛，轻烟散入五侯家。

韩翃的《寒食》，历来被认为是“飞花令”的出典。古人在寒食节有修禊的传统，书圣王右军就曾写下“暮春之初，会于会稽山阴之兰𠅘，修稧事也”的不朽诗序。魏晋以降，寒食节由三月上旬第一个巳日改为三月初三。今年的寒食节是四月三日，第一个巳日是四月十日（癸巳日）。欢迎加入 QQ 群 681811254 瞭解正在筹僃中的线上修禊活动。

## 插件使用方法

插件理论支持全版本，并主要在 `1.12.2` 和 `1.16.5` 版本进行测试。只需要在 GitHub Release 页面下载最新版并放入 `plugins` 文件夹即可。初次启动之后生成两个文件夹。

`preset` 文件夹内均为缓存，删除无碍。根据对 300000 首唐宋诗词的统计，自动生成了出现频率最高的 64 字的缓存。

`config` 文件夹内为配置文件。除 `Mix.yml` 外其他文件均仅代表对应种类的游戏配置。字段 `maxPlayers` 代表最大玩家数。字段 `minPlayers` 代表开启一局游戏所需最小玩家数。字段 `timeBeforeInit` 代表在游戏开始前可供玩家加入的准备时间长度（毫秒）。`roundNumber` 代表游戏有几轮。`timeRound` 代表每轮的长度。`maxAttempts` 代表玩家每轮有几次答题的尝试机会。

`Mix.yml` 可用于自定义游戏。比如自带的示例：

```yaml
"漫天飞花":
  maxPlayers: 10
  minPlayers: 2
  timeBeforeInit: 3000
  command: "blossoms"
  rounds:
    - "Fluttering_Blossoms"
    - "Fluttering_Blossoms"
    - "Fluttering_Blossoms"
    - "Fluttering_Blossoms"
    - "Fluttering_Blossoms"
```

这一示例中，玩家输入 `/blossoms join` 指令就可以进入游戏。可以自定义指令，这些指令将会被自动注册。进入游戏后这几位玩家将会连续玩五局飞花令。最终胜出的将是胜利总局数最多的人。可以根据自己的喜好随意安排游戏。

## 逰戏规则

<details>
    <summary>诗词辨认</summary>
    输入指令“/poetryidentification join” 加入逰戏。
    这之后，将会显示一组乱序的字，玩家需要排列出一句正确的诗句。五言诗句有两个字作为干扰项（七选五），七言诗句有五个字作为干扰项（十二选七）。所有诗句全部来自《唐诗三百首》。
    最快排列正确者答对这一题。答对题数最多者获胜。
    每次答题都必须在消息前加上“辨诗”二字，繁简均可。
    如有一组字：
    “春，城，无，处，不，飞，花，寒，食，东，风，御”，则玩家输入“辨诗 春城无处不飞花”即为正确。
</details>
<details>
    <summary>诗词猜测( Wordle )</summary>
    输入指令“/poetrywordle join” 加入逰戏。
    这之后，需要猜测一句五言或七言诗。所有诗句全部来自《唐诗三百首》。
    可以使用提示功能显示诗句作者以及诗句中某个位置的字。之所以提供作者是因为唐诗三百首选诗时限制了同一个作者选入的诗篇数目。
    也可以直接进行猜测，反馈的结果中绿色代表字的位置正确，黄色代表原诗包含此字但位置错误。红色代表没有此字。
    最快猜出者答对这一题。答对题数最多者获胜。
    每次答题都必须在消息前加上“猜诗”二字，繁简均可。
    如答案是“闲来垂钓碧溪上”，猜测“孤帆远影碧空尽”，则碧显示为绿色，其他字均为红色。
</details>

<details>
    <summary>诗词填空</summary>
    输入指令“/poetryfilling join” 加入逰戏。
    这之后，将会显示一句诗。诗中有一到两个字被抹去，需要玩家填空。所有诗句全部来自《唐诗三百首》。
    最快填出者答对这一题。答对题数最多者获胜。
    每次答题都必须在消息前加上“填空”二字，繁简均可。
    如有一句诗：
    “后宫佳丽 _ _ 人”，则玩家输入“填空 三千”即为正确。
</details>

<details>
    <summary>飞花令</summary>
    飞花令是文人雅集所行酒令。本插件飞花令规则与诗词大会之飞花令规则类似，但略有不同。
    输入指令 “/flutteringblossoms join” 加入逰戏。
    首先，每位玩家各说一个字，作为行令字僃选。之后将人气最高的字作为行令字。没有行令字则默认为“花”。
    每一位玩家按照次序，说出一句含有这个行令字的诗句。行令字的位置不论。祇要含有行令字即视作有效。不能说和其他玩家重复的诗句。
    如行令字为“月”，甲说“七月流火”，乙说“七月流火，九月授衣”，均对。乙虽然第一句与甲重，但第二句不重。
    如行令字为“花”，有三位玩家参与。甲说“春江花朝秋月夜”，乙说“年年岁岁花相似”，丙说“人面桃花相映红”。三位玩家全部说完则为一轮，此时又轮到甲。甲说“花间一壶酒”。乙丙在规定时间内不能对令，淘汰。
    当然，考虑到打字常会出错，只要在规定时间内就可以修改自己的错误答案。
    每次对令都必须在消息的最前方加上“行令”二字。如“行令 春城无处不飞花”。
</details>

繁体、简体行令本插件都支持。客户端语言为繁体则收到繁体中文消息，客户端语言为简体则收到简体中文消息。内部将完成繁简转换，以便使用繁体和简体的玩家同台竞技。

可以利用 `/flutteringblossoms tip` 来得到提示。编写事件监听器，监听 `AsyncPlayerTipEvent` 来控制提示功能，默认不限制。

## 其他说明

### 本人并非来自港澳台地区，祇是喜欢《说文解字》这类小学（文字音韵在古代统称小学）书籍。使用繁体字纯属兴趣使然。

### 本插件永久免费。

本插件主要通过 Bukkit 自带的 Event Bus 来提供 API 。如果你有意开发附属，欢迎联系我以添加或更改事件。事件全都位于 `api/events` 包下。

注意！本插件采用 [Chinese-Poetry](www.github.com/Chinese-Poetry/Chinese-Poetry) 的唐、宋二代古诗，未采用宋词。不能使用宋词行令。

注意！全部 300000 首左右古诗大小占 90+MB，不便插件使用，因此按自带的 [Rank](https://github.com/chinese-poetry/chinese-poetry/tree/master/rank) 排序，挑出 30000 首知名度排名最靠前的古诗，占 9 MB 左右，供匹配。排序可靠性未必很高，但自带的排序使用方便。有少部分名句未被收录，目前尚没有好的解决方法。（可能需要 Web API ）

注意！如果您想要修改古诗文本的部分，需要首先自行拉取 Chinese-Poetry （Unzipped 300+MB），文件夹重命名 `chinese-poetry-master` ，放在根目录。再修改 `dev` 包下的一些常量，重新生成 `json` 文件。不涉及到古诗文本的修改不需要如此麻烦，因所有文本已生成好、置于 `src/main/resources` 下。这些工作全由 `dev` 包内的一系列类和方法掌管。

