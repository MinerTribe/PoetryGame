# 飛花令

> 春城無處不飛花。寒食東風御柳斜。日暮漢宮傳蠟燭，輕烟散入五侯家。

韓翃的《寒食》，歷來被認為是“飛花令”的出典。古人在寒食節有修禊的傳統，書聖王右軍就曾寫下“暮春之初，會于會稽山隂之蘭𠅘，脩稧事也”的不朽詩序。魏晉以降，寒食節由三月上旬第一箇巳日改為三月初三。今年的寒食節是四月三日，第一箇巳日是四月十日（癸巳日）。歡迎加入 QQ 群 681811254 瞭解正在籌僃中的綫上修禊活動。

## 插件使用方法

插件理論支持全版本，並主要在 `1.12.2` 和 `1.16.5` 版本進行測試。只需要在 GitHub Release 頁面下載最新版並放入 `plugins` 文件夾即可。初次啓動之後生成兩箇文件夾。

`preset` 文件夾内均為緩存，刪除無礙。根據對 300000 首唐宋詩詞的統計，自動生成了出現頻率最高的 64 字的緩存。

`config` 文件夾内為配置文件。除 `Mix.yml` 外其他文件均僅代表對應種類的游戲配置。字段 `maxPlayers` 代表最大玩家數。字段 `minPlayers` 代表開啓一局游戲所需最小玩家數。字段 `timeBeforeInit` 代表在游戲開始前可供玩家加入的準備時間長度（毫秒）。`roundNumber` 代表游戲有幾輪。`timeRound` 代表每輪的長度。`maxAttempts` 代表玩家每輪有幾次答題的嘗試機會。

`Mix.yml` 可用於自定義游戲。比如自帶的示例：

```yaml
"漫天飛花":
  maxPlayers: 10
  minPlayers: 2
  timeBeforeInit: 3000
  command: "blossoms"
  rounds:
    - "Fluttering_Blossoms"
    - "Fluttering_Blossoms"
    - "Fluttering_Blossoms"
    - "Fluttering_Blossoms"
    - "Fluttering_Blossoms"
```

這一示例中，玩家輸入 `/blossoms join` 指令就可以進入游戲。可以自定義指令，這些指令將會被自動注冊。進入游戲后這幾位玩家將會連續玩五局飛花令。最終勝出的將是勝利總局數最多的人。可以根據自己的喜好隨意安排游戲。

## 逰戲槼則

<details>
    <summary>詩詞辨認</summary>
    輸入指令“/poetryidentification join” 加入逰戲。
    這之後，將會顯示一組亂序的字，玩家需要排列出一句正確的詩句。五言詩句有两箇字作為干擾項（七選五），七言詩句有五箇字作為干擾項（十二選七）。所有詩句全部來自《唐詩三百首》。
    最快排列正確者答對这一題。答對題數最多者獲勝。
    每次答題都必須在消息前加上“辨詩”二字，繁簡均可。
    如有一組字：
    “春，城，無，處，不，飛，花，寒，食，東，風，御”，则玩家輸入“辨诗 春城無處不飛花”即為正確。
</details>
<details>
    <summary>詩詞猜測( Wordle )</summary>
    輸入指令“/poetrywordle join” 加入逰戲。
    這之後，需要猜測一句五言或七言詩。所有詩句全部来自《唐詩三百首》。
    可以使用提示功能顯示詩句作者以及詩句中某个位置的字。之所以提供作者是因為唐詩三百首選詩时限制了同一个作者選入的詩篇數目。
    也可以直接進行猜測，反饋的結果中綠色代表字的位置正確，黄色代表原詩包含此字但位置錯誤。紅色代表没有此字。
    最快猜出者答對这一題。答对題數最多者獲勝。
    每次答題都必須在消息前加上“猜詩”二字，繁簡均可。
    如答案是“闲来垂钓碧溪上”，猜測“孤帆远影碧空尽”，則碧顯示为绿色，其他字均為紅色。
</details>

<details>
    <summary>詩詞填空</summary>
    輸入指令“/poetryfilling join” 加入逰戲。
    這之後，將會顯示一句詩。詩中有一到两箇字被抹去，需要玩家填空。所有詩句全部來自《唐詩三百首》。
    最快填出者答對这一題。答对題數最多者獲勝。
    每次答題都必須在消息前加上“填空”二字，繁簡均可。
    如有一句詩：
    “后宫佳丽 _ _ 人”，則玩家輸入“填空 三千”即為正確。
</details>

<details>
    <summary>飛花令</summary>
    飛花令是文人雅集所行酒令。本插件飛花令規則與詩詞大會之飛花令規則類似，但略有不同。
    輸入指令 “/flutteringblossoms join” 加入逰戲。
    首先，每位玩家各說一個字，作爲行令字僃選。之後將人氣最高的字作爲行令字。沒有行令字則默認為“花”。
    每一位玩家按照次序，説出一句含有這個行令字的詩句。行令字的位置不論。祇要含有行令字即視作有效。不能說和其他玩家重復的詩句。
    如行令字為“月”，甲說“七月流火”，乙說“七月流火，九月授衣”，均對。乙雖然第一句與甲重，但第二句不重。
    如行令字為“花”，有三位玩家參與。甲說“春江花朝秋月夜”，乙說“年年歲歲花相似”，丙說“人面桃花相映紅”。三位玩家全部説完則為一輪，此時又輪到甲。甲說“花間一壺酒”。乙丙在規定時間内不能對令，淘汰。
    當然，考慮到打字常會出錯，只要在規定時間内就可以修改自己的錯誤答案。
    每次對令都必須在消息的最前方加上“行令”二字。如“行令 春城無處不飛花”。
</details>

繁體、簡體行令本插件都支持。客戶端語言為繁體則收到繁體中文消息，客户端語言为簡體則收到簡體中文消息。内部將完成繁簡轉換，以便使用繁體和簡體的玩家同臺競技。

可以利用 `/flutteringblossoms tip` 来得到提示。編寫事件監聽器，監聽 `AsyncPlayerTipEvent` 来控制提示功能，默認不限制。

## 其他說明

### 本人並非來自港澳臺地區，祇是喜歡《説文解字》這類小學（文字音韻在古代統稱小學）書籍。使用繁體字純屬興趣使然。

### 本插件永久免費。

本插件主要通過 Bukkit 自帶的 Event Bus 來提供 API 。如果你有意開發附屬，歡迎聯係我以添加或更改事件。事件全都位於 `api/events` 包下。

注意！本插件采用 [Chinese-Poetry](www.github.com/Chinese-Poetry/Chinese-Poetry) 的唐、宋二代古詩，未采用宋詞。不能使用宋詞行令。

注意！全部 300000 首左右古詩大小占 90+MB，不便插件使用，因此按自帶的 [Rank](https://github.com/chinese-poetry/chinese-poetry/tree/master/rank) 排序，挑出 30000 首知名度排名最靠前的古詩，占 9 MB 左右，供匹配。排序可靠性未必很高，但自帶的排序使用方便。有少部分名句未被收錄，目前尚沒有好的解決方法。（可能需要 Web API ）

注意！如果您想要修改古詩文本的部分，需要首先自行拉取 Chinese-Poetry （Unzipped 300+MB），文件夹重命名 `chinese-poetry-master` ，放在根目錄。再修改 `dev` 包下的一些常量，重新生成 `json` 文件。不涉及到古詩文本的修改不需要如此麻煩，因所有文本已生成好、置于 `src/main/resources` 下。這些工作全由 `dev` 包內的一系列類和方法掌管。

